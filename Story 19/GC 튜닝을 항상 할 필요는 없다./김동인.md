# Overview

---

- 기본적인 메모리 크기 정도만 지정하면 웬만큼 사용량이 많지 않은 시스템에서는 튜닝을 할 필요가 없다.

# GC 튜닝을 꼭 해야할까?

---

- -Xms 옵션과 -Xmx 옵션으로 메모리 크기를 지정해야한다.
- -server 옵션이 포함되어있다.

시스템의 로그에는 타임아웃 관련 로그가 남아있지 않아야 한다.

- DB 작업과 관련된 타임아웃
- 다른 서버와의 통신시 타임아웃

타임아웃 로그가 존재하고 있다는 것은 시스템을 사용하는 사용자 중 대다수나 일부는 정상적인 응답을 받지 못했다는 것이다. 그 이유가 GC일 수 있다.

반대로 말하면 다음과 같은 경우에는 GC 튜닝이 필요하다.

- JVM의 메모리 크기를 지정하지 않았다.
- Timeout이 지속적으로 발생한다.

## Old 영역으로 넘어가는 객체의 수 최소화

- Oracle JVM에서 제공하는 모든 GC는 Generational GC이다.
- Eden 영역에서 객체가 처음 만들어지고 Survivor 영역을 오가다가 끝까지 남아있는 객체는 Old 영역으로 이동한다.
- Old 영역의 GC는 New 영역의 GC에 비해 상대적으로 시간이 오래소요 된다.

## Full GC 시간 줄이기

- Full GC의 수행시간은 상대적으로 Young GC에 비해 길다.
- Full GC 실행에 시간이 오래 소요되면 연계된 여러 부분에서 타임아웃이 발생할 수 있다.
- 그렇다고 Full GC 실행 시간을 줄이기 위해서 Old 영역의 크기를 줄이면 OutOfMemoryError가 발생하거나 Full GC 횟수가 늘어난다.
- 반대로 Old 영역의 크기를 늘리면 Full GC 횟수는 줄어들지만 실행 시간이 늘어난다.

# GC 튜닝의 절차

---

- GC 상황 모니터링
    - jstat 명령어를 사용한다
    1. YGC와 YGCT 값을 확인한다.
    2. FGCT와 FGC의 값을 확인하다.
    - -verbosegc 옵션으로 로그를 남겨 분석하느 ㄴ것이 좋다.
- 모니터링 결과 분석 후 GC 튜닝 여부 결정
- GC 방식/메모리 크기 지정
    - JVM의 시작 크기(-Xms)와 최대 크기(-Xmx)
- 결과 분석
    - Full GC 수행시간
    - Minor GC 수행시간
    - Full GC 수행 간격
    - Minor GC 수행 간격
    - 전체 Full GC 수행시간
    - 전체 Minor GC 수행시간
    - 전체 GC 수행시간
    - Full GC 수행횟수
    - Minor GC 수행횟수
- 결과가 만족스러울 경우 서버에 반영
